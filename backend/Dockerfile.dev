# Development Dockerfile with hot reload (Debian-based for Prisma compatibility)
FROM node:18-bullseye-slim

WORKDIR /app

# System deps needed for Prisma engines and HTTPS
RUN apt-get update && apt-get install -y --no-install-recommends \
    openssl ca-certificates curl build-essential python3 \
  && rm -rf /var/lib/apt/lists/*

# Install dependencies
COPY package*.json ./
RUN npm install
RUN npm rebuild bcrypt --build-from-source

# Copy prisma schema and generate client
COPY prisma ./prisma/
RUN npx prisma generate

# Copy source code
COPY . .

EXPOSE 5000

CMD ["npm", "run", "dev"]
